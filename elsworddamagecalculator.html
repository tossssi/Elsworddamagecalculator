<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELSWORD„Çπ„ÉÜ„Éº„Çø„ÇπÂäπÁéáË®àÁÆó</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0d0d0d;
            --card-bg: #1a1a1a;
            --card-hover: #252525;
            --input-bg: #000000;
            --text-main: #ffffff;
            --text-sub: #aaa;
            
            --accent-cyan: #00e5ff;
            --accent-yellow: #ffea00;
            --alert-red: #ff4444;
            --border-dim: #333;
            
            --toggle-off: #444;
            --toggle-on: var(--accent-cyan);
        }

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            font-size: 14px;
        }

        .container {
            width: 100%;
            max-width: 950px;
        }

        /* --- „Éò„É´„Éó„Éú„Çø„É≥„Ç®„É™„Ç¢ --- */
        .nav-area {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 8px;
            padding: 0 5px;
        }

        .help-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-cyan), #00b8cc);
            border: none;
            color: #000;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 0 5px rgba(0, 229, 255, 0.5);
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }
        .help-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--accent-cyan);
        }

        /* --- „Éò„ÉÉ„ÉÄ„Éº --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #111;
            border-bottom: 1px solid var(--border-dim);
            margin-bottom: 10px;
            border-radius: 8px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        h1 {
            font-size: 1.3rem;
            color: #e0e0e0;
            margin: 0;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.6);
            font-weight: 800;
        }

        .total-display-compact {
            font-size: 1.5rem;
            font-weight: 800;
            color: #fff;
        }
        .total-label-compact {
            font-size: 0.8rem;
            color: #888;
            margin-right: 10px;
        }

        /* --- „É™„Çπ„Éà --- */
        .stats-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 4px;
            overflow: hidden;
            border-left: 3px solid transparent;
            transition: border-color 0.3s ease;
        }

        .stat-header {
            position: relative;
            height: 44px;
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
            overflow: hidden;
        }
        .stat-header:hover {
            background-color: var(--card-hover);
        }

        .bg-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: var(--accent-cyan);
            opacity: 0.1;
            z-index: 0;
            width: 0%;
            transition: width 0.5s ease, background-color 0.3s ease;
        }

        .header-content {
            position: relative;
            z-index: 1;
            display: flex;
            width: 100%;
            justify-content: space-between;
            align-items: center;
        }

        .stat-icon-img {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            object-fit: contain;
            filter: drop-shadow(0 0 2px rgba(0,0,0,0.5));
        }

        .stat-name {
            font-weight: bold;
            font-size: 0.95rem;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-right: 10px;
            display: flex;
            align-items: center;
        }

        .meta-group {
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        .label-text { font-size: 0.75rem; color: #888; margin-right: 4px; }
        .val-text { font-size: 1rem; color: #fff; min-width: 60px; text-align: right; }
        .eff-text { font-size: 0.9rem; color: var(--accent-cyan); min-width: 60px; text-align: right; }
        
        .spacer { width: 20px; }
        .arrow { font-size: 0.8rem; color: #555; margin-left: 10px; transition: transform 0.3s; }
        
        .stat-card[data-rank="1"]:not([data-over="true"]) { border-left-color: var(--accent-yellow); }
        .stat-card[data-rank="1"]:not([data-over="true"]) .eff-text { color: var(--accent-yellow); }
        .stat-card[data-rank="1"]:not([data-over="true"]) .bg-bar { background-color: var(--accent-yellow); opacity: 0.15; }

        .stat-card:not([data-rank="1"]) { border-left-color: var(--accent-cyan); }

        /* --- Ë©≥Á¥∞„Ç®„É™„Ç¢ --- */
        .details-section {
            background-color: #111;
            border-top: 1px solid #222;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
        }
        .details-section.open { max-height: 2000px; padding: 10px; overflow: visible; }
        .details-section.open + .header-content .arrow { transform: rotate(180deg); } 

        .breakdown-row {
            display: grid;
            gap: 8px;
            margin-bottom: 4px;
            align-items: center;
        }
        
        .breakdown-row.crit { grid-template-columns: 1fr 70px 15px 60px 40px 30px; }
        .breakdown-row.simple { grid-template-columns: 1fr 70px 15px 40px 30px; }
        .breakdown-row.toggle-row { grid-template-columns: 1fr 100px 30px; }

        .breakdown-row.disabled input[type="text"],
        .breakdown-row.disabled input[type="number"],
        .breakdown-row.disabled select,
        .breakdown-row.disabled .unit-label,
        .breakdown-row.disabled .item-icon,
        .breakdown-row.disabled .type-label {
            opacity: 0.4;
        }

        .name-container {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .item-icon {
            width: 16px;
            height: 16px;
            margin-right: 6px;
            object-fit: contain;
            opacity: 0.8;
        }

        .breakdown-row input[type="text"] {
            background: transparent; border: none; color: #aaa; border-bottom: 1px solid #333; 
            padding: 2px 5px; width: 100%; font-size: 0.9rem;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            transition: opacity 0.2s;
        }
        .breakdown-row input[type="number"] {
            background: var(--input-bg); border: 1px solid #333; border-radius: 4px; color: #fff; 
            padding: 4px; text-align: right; font-weight: bold; width: 100%; font-size: 0.9rem;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            transition: opacity 0.2s;
        }
        .breakdown-row select {
            background: #222; border: 1px solid #444; color: #fff; padding: 2px; border-radius: 4px; font-size: 0.8rem;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            transition: opacity 0.2s;
        }
        
        /* Âõ∫ÂÆö„ÅÆ„Çø„Ç§„Éó„É©„Éô„É´ÔºàÂä†ÁÆó„Éª‰πóÁÆóÔºâ */
        .type-label {
            color: #888;
            font-size: 0.8rem;
            text-align: center;
            font-weight: bold;
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }
        
        .unit-label { color: #555; font-size: 0.8rem; text-align: center; }

        .remove-btn { 
            background: #2a2a2a; border: 1px solid #333; color: #888; 
            cursor: pointer; text-align: center; font-weight: bold; font-size: 1rem;
            line-height: 24px; height: 26px; border-radius: 6px;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .remove-btn:hover { background-color: var(--alert-red); color: #fff; border-color: var(--alert-red); }
        .remove-placeholder { height: 26px; width: 100%; }

        .add-btn {
            background: #222; border: 1px dashed #444; color: #666; width: 100%; 
            padding: 6px; border-radius: 4px; cursor: pointer; margin-top: 5px; font-size: 0.85rem;
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }
        .add-btn:hover { background: #333; color: #fff; }
        
        .formula-note { font-size: 0.9rem; color: #666; margin-bottom: 10px; }
        
        /* Âõ∫ÂÆöÂÄ§„Çπ„Çø„Ç§„É´ */
        .fixed-val { 
            color: #555 !important; 
            pointer-events: none; 
            border: none !important; 
            background: transparent !important; 
        }

        /* --- „Éà„Ç∞„É´„Çπ„Ç§„ÉÉ„ÉÅ --- */
        .switch-container { display: flex; align-items: center; justify-content: center; width: 100%; }
        .switch { position: relative; display: inline-block; width: 36px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--toggle-off); transition: .4s; border-radius: 20px;
        }
        .slider:before {
            position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--toggle-on); box-shadow: 0 0 8px var(--toggle-on); }
        input:checked + .slider:before { transform: translateX(16px); }
        .switch-label { margin-right: 10px; font-size: 0.8rem; color: #aaa; }

        /* --- „É¢„Éº„ÉÄ„É´ --- */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px); }
        .modal-content { background-color: #1a1a1a; margin: 5% auto; padding: 0; border: 1px solid var(--accent-cyan); border-radius: 12px; width: 90%; max-width: 700px; box-shadow: 0 0 20px rgba(0, 229, 255, 0.3); color: #fff; animation: modalFadeIn 0.3s; }
        @keyframes modalFadeIn { from {opacity: 0; transform: translateY(-20px);} to {opacity: 1; transform: translateY(0);} }
        .modal-header { padding: 15px 20px; background: #111; border-bottom: 1px solid #333; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 1.2rem; font-weight: bold; color: var(--accent-cyan); }
        .close-btn { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 1; }
        .close-btn:hover { color: #fff; }
        .modal-body { padding: 20px; }
        .guide-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 600px) { .guide-grid { grid-template-columns: 1fr; } }
        .guide-step { background: #222; padding: 15px; border-radius: 8px; border-left: 4px solid #555; }
        .step-num { font-size: 0.8rem; color: var(--accent-cyan); font-weight: bold; margin-bottom: 5px; display: block; }
        .step-text { font-size: 0.95rem; line-height: 1.6; }
        .highlight-yellow { color: var(--accent-yellow); font-weight: bold; }
        .highlight-red { color: var(--alert-red); font-weight: bold; }
        .modal-footer { padding: 15px; text-align: center; border-top: 1px solid #333; font-size: 0.9rem; color: #888; }

    </style>
</head>
<body>

<div class="container">
    <div class="nav-area">
        <button id="helpBtn" class="help-btn">?</button>
    </div>

    <header>
        <h1>ELSWORD„Çπ„ÉÜ„Éº„Çø„ÇπÂäπÁéáË®àÁÆó</h1>
        <div>
            <span class="total-label-compact">TOTAL MULTIPLIER</span>
            <span class="total-display-compact" id="totalDisplay">0.00</span>
        </div>
    </header>

    <div class="stats-list" id="statsList"></div>
</div>

<div id="helpModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">üìå ‰Ωø„ÅÑÊñπ„Ç¨„Ç§„Éâ</div>
            <span class="close-btn" id="closeModal">&times;</span>
        </div>
        <div class="modal-body">
            <div class="guide-grid">
                <div class="guide-step" style="border-left-color: var(--accent-cyan);">
                    <span class="step-num">STEP 1</span>
                    <div class="step-text">
                        È†ÖÁõÆ„ÅÆ„Éê„Éº„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÄÅË©≥Á¥∞„ÇíÈñã„Åç„Åæ„Åô„ÄÇ<br>
                        Êï∞ÂÄ§ÂÖ•Âäõ„ÇÑ„Çπ„Ç§„ÉÉ„ÉÅ(ON/OFF)„Åß„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Åß„Åç„Åæ„Åô„ÄÇ
                    </div>
                </div>
                <div class="guide-step" style="border-left-color: var(--accent-cyan);">
                    <span class="step-num">STEP 2</span>
                    <div class="step-text">
                        Âè≥ÂÅ¥„ÅÆ<strong>„Äå1%‰∏äÊòáÂäπÁéá„Äç</strong>„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºÅ<br>
                        „Åì„ÅÆÊï∞ÂÄ§„ÅåÂ§ß„Åç„ÅÑÈ†ÖÁõÆ„ÇíÂº∑Âåñ„Åô„Çã„ÅÆ„ÅåÊúÄ„ÇÇÂäπÁéáÁöÑ„Åß„Åô„ÄÇ
                    </div>
                </div>
                <div class="guide-step" style="border-left-color: var(--accent-yellow);">
                    <span class="step-num">STEP 3</span>
                    <div class="step-text">
                        ÂäπÁéáNo.1„ÅØ<span class="highlight-yellow">ÈªÑËâ≤„ÅÆ„Éê„Éº</span>„ÄÅ<br>
                        Ê∏õË°∞„É©„Ç§„É≥(280%)Ë∂Ö„Åà„ÅØ<span class="highlight-red">Ëµ§Ëâ≤„ÅÆ„Éê„Éº</span>„ÅßË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ
                    </div>
                </div>
                <div class="guide-step" style="border-left-color: #fff;">
                    <span class="step-num">TIP</span>
                    <div class="step-text">
                        üìå„Ç¢„Ç§„Ç≥„É≥„ÅÆÈ†ÖÁõÆ„ÅØÂâäÈô§„Åß„Åç„Åæ„Åõ„Çì„ÄÇÂü∫Á§éÂÄ§(Âõ∫ÂÆö)„ÅØ„Çπ„Ç§„ÉÉ„ÉÅ„ÇÇÊìç‰Ωú„Åß„Åç„Åæ„Åõ„Çì„ÄÇ
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            Ë®àÁÆóÊ©ü„Çí‰Ωø„Å£„Å¶ÊúÄÂº∑„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÁõÆÊåá„Åù„ÅÜÔºÅüî•
        </div>
    </div>
</div>

<script>
    // ‚ñº „Ç´„ÉÜ„Ç¥„É™„Ç¢„Ç§„Ç≥„É≥ ‚ñº
    const icons = {
        sword: 'https://placehold.jp/30/00e5ff/ffffff/24x24.png?text=‚öîÔ∏è', 
        crit: 'https://placehold.jp/30/ffea00/000000/24x24.png?text=üí•',
        boss: 'https://placehold.jp/30/ff4444/ffffff/24x24.png?text=üëø',
        skill: 'https://placehold.jp/30/00e5ff/ffffff/24x24.png?text=‚ú®',
        trans: 'https://placehold.jp/30/aa00ff/ffffff/24x24.png?text=üîÆ',
        polar: 'https://placehold.jp/30/ffffff/000000/24x24.png?text=‚òØÔ∏è',
        dot: 'https://placehold.jp/30/00ff00/000000/24x24.png?text=‚ò†Ô∏è',
        hp: 'https://placehold.jp/30/ff0000/ffffff/24x24.png?text=‚ù§Ô∏è'
    };
    
    // ‚ñº ÂàùÊúüÈ†ÖÁõÆÁî®„Ç¢„Ç§„Ç≥„É≥Ôºà„Éî„É≥Ôºâ ‚ñº
    const presetIcon = 'https://placehold.jp/20/ffffff/000000/16x16.png?text=üìå';

    /*
      „Éá„Éº„ÇøË®≠ÂÆö
      fixed: true -> ÂâäÈô§‰∏çÂèØ(√ó„Éú„Çø„É≥„Å™„Åó)„ÄÅüìå„Ç¢„Ç§„Ç≥„É≥Ë°®Á§∫
      edit: true -> Êï∞ÂÄ§ÂÖ•ÂäõÂèØËÉΩ
      edit: false -> Êï∞ÂÄ§ÂÖ•Âäõ‰∏çÂèØ(„Ç∞„É¨„Éº„Ç¢„Ç¶„Éà)
    */
    let statsData = [
        { 
            id: "atk_percent", 
            name: "Áâ©È≠îÊîªÊíÉÂäõ(%)", 
            icon: icons.sword,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true }, // ÊúÄ‰∏äÈÉ®Âõ∫ÂÆö
                { label: "Ê≠¶Âô®È≠îÂäõ‰ªò‰∏é ÂêàÁÆó", val: 37.5, fixed: true, edit: true, on: true },
                { label: "„Ç®„ÇØ„ÇµÂÜçÈå¨ÂäπÊûú", val: 8, fixed: true, edit: true, on: true },
                { label: "„É¨„Ç¢„Éê„Çª„ÉÉ„ÉàÂäπÊûú", val: 6, fixed: true, edit: true, on: true },
                { label: "„É¨„Ç¢„Éê„Ç¢„ÇØ„ÇªÂäπÊûú", val: 9, fixed: true, edit: true, on: true },
                { label: "„Ç®„É´„Ç≥„É¨ÂäπÊûú", val: 3.75, fixed: true, edit: true, on: true },
                { label: "„Ç™„Éó„Ç∑„Éß„É≥Â§âÊèõÂäπÊûú", val: 12, fixed: true, edit: true, on: true },
                
                // --- „Åì„Åì„Åã„ÇâÁ∑®ÈõÜ‰∏çÂèØ„Ç∞„É´„Éº„Éó ---
                { label: "„Çπ„Ç≠„É™„É≥[Âõ∫ÂÆöÂäπÊûú]", val: 0.5, fixed: true, edit: false, on: true },
                { label: "„Éö„ÉÉ„Éà„Éë„ÉÉ„Ç∑„Éñ", val: 2, fixed: true, edit: false, on: true },
                { label: "„Ç¢„Éº„ÉÜ„Ç£„Éï„Ç°„ÇØ„ÉàÊàêÈï∑1ÊÆµÈöé", val: 3, fixed: true, edit: false, on: true },
                { label: "„Ç∑„Éä„Ç∏„Éº", val: 1, fixed: true, edit: false, on: true },
            ] 
        },
        { 
            id: "cri_dmg", 
            name: "„ÇØ„É™„ÉÜ„Ç£„Ç´„É´„ÉÄ„É°„Éº„Ç∏", 
            icon: icons.crit,
            calcType: "crit",
            items: [
                { label: "„Çπ„ÉÜË°®Ë®ò", val: 215.00, type: "stat_window", fixed: true, edit: true, on: true },
                { label: "Âä†ÁÆó„Éë„ÉÉ„Ç∑„Éñ", val: 0, type: "add", fixed: true, edit: true, on: true },
                { label: "‰πóÁÆó„Éë„ÉÉ„Ç∑„Éñ", val: 0, type: "multi", fixed: true, edit: true, on: true },
                { label: "„Ç¢„ÉÉ„Éà„ÉûËçâÊú®", val: 26, type: "multi", fixed: true, edit: true, on: true },
                
                // --- Á∑®ÈõÜ‰∏çÂèØ„Ç∞„É´„Éº„Éó ---
                { label: "„Ç®„ÇØ„ÇµËµ§„Çª„ÉÉ„Éà", val: 10, type: "multi", fixed: true, edit: false, on: true },
                { label: "ÂàªÂç∞", val: 5, type: "multi", fixed: true, edit: false, on: true },
                { label: "„Éû„Ç®„Çπ„Éà„É≠„Éò„Ç§„É≠„Éº", val: 2, type: "multi", fixed: true, edit: false, on: true },
            ]
        },
        { 
            id: "boss_dmg", 
            name: "„Éú„Çπ„Å´‰∏é„Åà„Çã„ÉÄ„É°„Éº„Ç∏Â¢óÂä†", 
            icon: icons.boss,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true },
                { label: "„Çπ„ÉÜ„Éº„Çø„ÇπË°®Ë®ò", val: 150.00, fixed: true, edit: true, on: true },
                { label: "Âä†ÁÆó„Éë„ÉÉ„Ç∑„Éñ", val: 0.00, fixed: true, edit: true, on: true },
                { label: "„ÇÆ„É´„Éâ„Çπ„Ç≠„É´", val: 2.50, fixed: true, edit: true, on: true }
            ]
        },
        { 
            id: "all_skill", 
            name: "ÂÖ®„Å¶„ÅÆ„Çπ„Ç≠„É´„ÉÄ„É°„Éº„Ç∏Â¢óÂä†", 
            icon: icons.skill,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true }, 
                { label: "„Çπ„ÉÜ„Éº„Çø„ÇπË°®Ë®ò", val: 104.50, fixed: true, edit: true, on: true }
            ] 
        },
        { 
            id: "trans_skill", 
            name: "Âº∑ÁÉà„ÄÅË∂ÖË∂ä„Çπ„Ç≠„É´„ÉÄ„É°„Éº„Ç∏Â¢óÂä†", 
            icon: icons.trans,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true }, 
                { label: "„Çπ„ÉÜ„Éº„Çø„ÇπË°®Ë®ò", val: 122.00, fixed: true, edit: true, on: true }
            ] 
        },
        { 
            id: "polar", 
            name: "‰∏°Ê•µÂåñÔºöÊîªÊíÉ/Âèó„Åë„Çã„ÉÄ„É°„Éº„Ç∏Â¢óÂä†", 
            icon: icons.polar,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true }, 
                { label: "„Çπ„ÉÜ„Éº„Çø„ÇπË°®Ë®ò", val: 53.70, fixed: true, edit: true, on: true }
            ] 
        },
        { 
            id: "dot", 
            name: "‰∏é„Åà„Åü„ÉÄ„É°„Éº„Ç∏„ÅÆn%„ÇíËøΩÂä†ÊåÅÁ∂ö„ÉÄ„É°„Éº„Ç∏", 
            icon: icons.dot,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true },
                { label: "„Ç®„ÇØ„Çµ‰∏äË°£ÂõûË∑Ø", val: 12.00, fixed: true, edit: true, on: true },
                { label: "„Ç®„ÇØ„Çµ„ÉÅ„ÉÉ„Éó", val: 12.00, fixed: true, edit: true, on: true },
                { label: "„Ç¢„ÉÉ„Éà„Éû‰∏ä„Ç¢„ÇØ„Çª", val: 5.00, fixed: true, edit: true, on: true },
                { label: "„É¨„Ç¢„Éê„Çª„ÉÉ„ÉàÂäπÊûú", val: 12.00, fixed: true, edit: true, on: true },
                { label: "„É¨„Ç¢„ÉêÊ≠¶Âô®ÂäπÊûú", val: 5.00, fixed: true, edit: true, on: true },
                { label: "„É¨„Ç¢„Éê„Ç¢„ÇØ„ÇªÂäπÊûú", val: 7.00, fixed: true, edit: true, on: true },
                { label: "„Ç™„Éó„Ç∑„Éß„É≥Â§âÊèõÂäπÊûú", val: 12.00, fixed: true, edit: true, on: true },
                
                // --- Á∑®ÈõÜ‰∏çÂèØ„Ç∞„É´„Éº„Éó ---
                { label: "„É¨„Ç§„Éâ3ÁÇπ„Çª„ÉÉ„ÉàÂäπÊûú", val: 5.00, fixed: true, edit: false, on: true },
                { label: "„É™„É≥„ÇØ„Ç¢„ÉêÂäπÊûú", val: 2.00, fixed: true, edit: false, on: true },
                { label: "„Ç∑„Éä„Ç∏„ÉºÔºöÊ≠™Êõ≤", val: 2.00, fixed: true, edit: false, on: true },
            ]
        },
        { 
            id: "hp100_under", 
            name: "HP100ÔºÖ‰ª•‰∏ã„ÅÆÊïµ„ÇíÊîªÊíÉÊôÇ„ÄÅ„ÉÄ„É°„Éº„Ç∏Â¢óÂä†", 
            icon: icons.hp,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true },
                { label: "„É¨„Ç¢„Éê„Çª„ÉÉ„ÉàÂäπÊûú", val: 10, fixed: true, edit: true, on: true },
                { label: "Ê≠¶Âô®ÂäπÊûú", val: 5, fixed: true, edit: false, on: true },
            ] 
        },
        { 
            id: "hp50_over", 
            name: "HP50ÔºÖË∂ÖÈÅé„ÅÆÊïµ„ÇíÊîªÊíÉÊôÇ„ÄÅ„ÉÄ„É°„Éº„Ç∏Â¢óÂä†", 
            icon: icons.hp,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true },
                { label: "„Ç®„ÇØ„ÇµÂõûË∑ØÂäπÊûú", val: 10, fixed: true, edit: true, on: true },
                { label: "„Ç®„ÇØ„Çµ„ÉÅ„ÉÉ„ÉóÂäπÊûú", val: 5, fixed: true, edit: true, on: true }
            ] 
        },
        { 
            id: "hp50_under", 
            name: "HP50ÔºÖ‰ª•‰∏ã„ÅÆÊïµ„ÇíÊîªÊíÉÊôÇ„ÄÅ„ÉÄ„É°„Éº„Ç∏Â¢óÂä†", 
            icon: icons.hp,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true },
                { label: "„Ç®„ÇØ„ÇµÂõûË∑ØÂäπÊûú", val: 10, fixed: true, edit: true, on: true },
                { label: "„Ç®„ÇØ„Çµ„ÉÅ„ÉÉ„ÉóÂäπÊûú", val: 5, fixed: true, edit: true, on: true }
            ] 
        },
        { 
            id: "hp30", 
            name: "HP30ÔºÖ‰ª•‰∏ã„ÅÆÊïµ„ÇíÊîªÊíÉÊôÇ„ÄÅ„ÉÄ„É°„Éº„Ç∏Â¢óÂä†", 
            icon: icons.hp,
            calcType: "simple",
            items: [
                { label: "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)", val: 100, fixed: true, edit: false, on: true },
                { label: "„ÇΩ„Ç±„ÉÉ„ÉàÂäπÊûú", val: 0, fixed: true, edit: false, on: true }
            ] 
        },
    ];

    const listContainer = document.getElementById('statsList');
    const totalDisplay = document.getElementById('totalDisplay');
    const modal = document.getElementById("helpModal");
    const helpBtn = document.getElementById("helpBtn");
    const closeBtn = document.getElementById("closeModal");

    function init() {
        render();
        calculate();
        setupModal();
    }
    
    function setupModal() {
        helpBtn.onclick = function() { modal.style.display = "block"; }
        closeBtn.onclick = function() { modal.style.display = "none"; }
        window.onclick = function(event) { if (event.target == modal) { modal.style.display = "none"; } }
    }

    function render() {
        listContainer.innerHTML = '';
        statsData.forEach((cat, index) => {
            const card = document.createElement('div');
            card.className = 'stat-card';
            card.id = `card-${index}`;

            const header = document.createElement('div');
            header.className = 'stat-header';
            header.onclick = () => toggleDetails(index);
            header.innerHTML = `
                <div class="bg-bar" id="bar-${index}"></div>
                <div class="header-content">
                    <div class="stat-name">
                        <img src="${cat.icon}" class="stat-icon-img" alt="icon">
                        ${cat.name}
                    </div>
                    <div class="meta-group">
                        <span class="label-text">ÂêàË®à:</span>
                        <span class="val-text" id="total-${index}">0%</span>
                        <div class="spacer"></div>
                        <span class="label-text">1%‰∏äÊòáÂäπÁéá:</span>
                        <span class="eff-text" id="eff-${index}">+0%</span>
                        <span class="arrow" id="arrow-${index}">‚ñº</span>
                    </div>
                </div>
            `;

            const details = document.createElement('div');
            details.className = 'details-section';
            details.id = `details-${index}`;

            const note = document.createElement('div');
            note.className = 'formula-note';
            if(cat.calcType === 'crit') {
                note.innerText = 'Âºè: („Çπ„ÉÜË°®Ë®ò - 150) + Âä†ÁÆó + (150 √ó ‰πóÁÆóË£úÊ≠£)';
            } else {
                note.innerText = 'Âºè: Âü∫Á§éÂÄ§(100%) + Âä†ÁÆóÂÄ§„ÅÆÂêàË®à';
            }
            details.appendChild(note);

            const rowsContainer = document.createElement('div');
            rowsContainer.id = `rows-${index}`;
            details.appendChild(rowsContainer);

            const addBtn = document.createElement('button');
            addBtn.className = 'add-btn';
            addBtn.innerText = 'Ôºã È†ÖÁõÆ„ÇíËøΩÂä†';
            addBtn.onclick = (e) => { e.stopPropagation(); addItem(index); };
            details.appendChild(addBtn);

            card.appendChild(header);
            card.appendChild(details);
            listContainer.appendChild(card);

            renderRows(index);
        });
    }

    function renderRows(catIndex) {
        const container = document.getElementById(`rows-${catIndex}`);
        const cat = statsData[catIndex];
        container.innerHTML = '';
        
        cat.items.forEach((item, itemIndex) => {
            const row = document.createElement('div');
            
            if (item.type === 'toggle') {
                row.className = 'breakdown-row toggle-row';
            } else {
                let rowClass = cat.calcType === 'crit' ? 'breakdown-row crit' : 'breakdown-row simple';
                if (item.on === false) rowClass += ' disabled';
                row.className = rowClass;
            }

            // ÂêçÂâçÂÖ•Âäõ„Ç®„É™„Ç¢
            const nameContainer = document.createElement('div');
            nameContainer.className = 'name-container';
            
            // Âõ∫ÂÆöÈ†ÖÁõÆ„ÅÆÂ†¥Âêà„ÅØ„Éî„É≥„Ç¢„Ç§„Ç≥„É≥Ë°®Á§∫
            if (item.fixed) {
                const iconImg = document.createElement('img');
                iconImg.src = presetIcon;
                iconImg.className = 'item-icon';
                nameContainer.appendChild(iconImg);
            }

            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.value = item.label;
            nameInput.placeholder = 'È†ÖÁõÆÂêç';
            if(item.fixed) nameInput.readOnly = true;
            nameInput.oninput = (e) => { cat.items[itemIndex].label = e.target.value; };
            
            nameContainer.appendChild(nameInput);
            row.appendChild(nameContainer);

            if (item.type === 'toggle') {
                const switchContainer = document.createElement('div');
                switchContainer.className = 'switch-container';
                
                const label = document.createElement('span');
                label.className = 'switch-label';
                label.innerText = (item.val > 0 ? '+' : '') + item.val + '%';
                
                const labelSwitch = document.createElement('label');
                labelSwitch.className = 'switch';
                
                const chk = document.createElement('input');
                chk.type = 'checkbox';
                chk.checked = item.on;
                chk.onchange = (e) => {
                    cat.items[itemIndex].on = e.target.checked;
                    renderRows(catIndex);
                    calculate();
                };
                
                const slider = document.createElement('span');
                slider.className = 'slider';
                
                labelSwitch.appendChild(chk);
                labelSwitch.appendChild(slider);
                switchContainer.appendChild(label);
                switchContainer.appendChild(labelSwitch);
                
                row.appendChild(switchContainer);
            } else {
                const valInput = document.createElement('input');
                valInput.type = 'number';
                valInput.value = item.val;
                valInput.step = '0.1';
                if(item.edit === false) {
                    valInput.className = 'fixed-val';
                    valInput.readOnly = true;
                }
                valInput.oninput = (e) => {
                    let v = parseFloat(e.target.value);
                    if(isNaN(v)) v = 0;
                    cat.items[itemIndex].val = v;
                    calculate();
                };
                row.appendChild(valInput);
                
                const unitLabel = document.createElement('div');
                unitLabel.className = 'unit-label';
                unitLabel.innerText = '%';
                row.appendChild(unitLabel);
            }

            if (cat.calcType === 'crit' && item.type !== 'toggle') {
                if (item.fixed) {
                    // Âõ∫ÂÆöÈ†ÖÁõÆ„ÅØ„Çø„Ç§„ÉóÂõ∫ÂÆö
                    const typeLabel = document.createElement('div');
                    typeLabel.className = 'type-label';
                    if (item.type === 'stat_window') typeLabel.innerText = '„Çπ„ÉÜ';
                    else if (item.type === 'add') typeLabel.innerText = 'Âä†ÁÆó';
                    else if (item.type === 'multi') typeLabel.innerText = '‰πóÁÆó';
                    row.appendChild(typeLabel);
                } else {
                    const typeSelect = document.createElement('select');
                    const ops = [
                        {val: 'add', text: 'Âä†ÁÆó'},
                        {val: 'multi', text: '‰πóÁÆó'},
                    ];
                    ops.forEach(o => {
                        const op = document.createElement('option');
                        op.value = o.val;
                        op.text = o.text;
                        if(item.type === o.val) op.selected = true;
                        typeSelect.appendChild(op);
                    });
                    typeSelect.onchange = (e) => {
                        cat.items[itemIndex].type = e.target.value;
                        calculate();
                    };
                    row.appendChild(typeSelect);
                }
            }

            // ON/OFF„Çπ„Ç§„ÉÉ„ÉÅ (ÂÖ®È†ÖÁõÆ - Âü∫Á§éÂÄ§„Å†„Åë„ÅØ„Çπ„Ç§„ÉÉ„ÉÅÈùûË°®Á§∫)
            if (item.type !== 'toggle') {
                if(item.label === "Âü∫Á§éÂÄ§(Âõ∫ÂÆö)") {
                    // „Çπ„Ç§„ÉÉ„ÉÅ„ÅÆ‰ª£„Çè„Çä„Å´„ÉÄ„Éü„Éº
                    const dummy = document.createElement('div');
                    dummy.style.width = '36px'; 
                    row.appendChild(dummy);
                } else {
                    const switchContainer = document.createElement('div');
                    switchContainer.className = 'switch-container';
                    const labelSwitch = document.createElement('label');
                    labelSwitch.className = 'switch';
                    const chk = document.createElement('input');
                    chk.type = 'checkbox';
                    chk.checked = item.on !== false;
                    chk.onchange = (e) => {
                        cat.items[itemIndex].on = e.target.checked;
                        renderRows(catIndex);
                        calculate();
                    };
                    const slider = document.createElement('span');
                    slider.className = 'slider';
                    labelSwitch.appendChild(chk);
                    labelSwitch.appendChild(slider);
                    switchContainer.appendChild(labelSwitch);
                    row.appendChild(switchContainer);
                }
            }

            // ÂâäÈô§„Éú„Çø„É≥ (Âõ∫ÂÆöÈ†ÖÁõÆ„ÅØÂâäÈô§‰∏çÂèØÔºùÁ©∫Ê¨Ñ)
            if(!item.fixed) {
                const delBtn = document.createElement('div');
                delBtn.className = 'remove-btn';
                delBtn.innerText = '√ó';
                delBtn.onclick = () => {
                    cat.items.splice(itemIndex, 1);
                    renderRows(catIndex);
                    calculate();
                };
                row.appendChild(delBtn);
            } else {
                const placeholder = document.createElement('div');
                placeholder.className = 'remove-placeholder';
                row.appendChild(placeholder);
            }

            container.appendChild(row);
        });
    }

    function addItem(catIndex) {
        const cat = statsData[catIndex];
        const type = cat.calcType === 'crit' ? 'multi' : 'add';
        cat.items.push({ label: 'Êñ∞Ë¶è', val: 0, fixed: false, edit: true, type: type, on: true });
        renderRows(catIndex);
    }

    function toggleDetails(index) {
        document.getElementById(`details-${index}`).classList.toggle('open');
        const arrow = document.getElementById(`arrow-${index}`);
        if(document.getElementById(`details-${index}`).classList.contains('open')) {
            arrow.style.transform = 'rotate(180deg)';
        } else {
            arrow.style.transform = 'rotate(0deg)';
        }
    }

    function calculate() {
        let globalMultiplier = 1.0;
        let efficiencies = [];

        statsData.forEach((cat, idx) => {
            let catTotal = 0;

            if (cat.calcType === 'crit') {
                let additiveTotal = 0;
                let multiplierProduct = 1.0;
                cat.items.forEach(item => {
                    if (item.on === false) return; // OFF„Å™„Çâ„Çπ„Ç≠„ÉÉ„Éó

                    if (item.type === 'stat_window') {
                        additiveTotal += (item.val - 150);
                    } else if (item.type === 'add') {
                        additiveTotal += item.val;
                    } else if (item.type === 'multi') {
                        multiplierProduct *= (1 + item.val / 100);
                    } else if (item.type === 'toggle') {
                        if (item.on) multiplierProduct *= (1 + item.val / 100);
                    }
                });
                const base = 150;
                catTotal = additiveTotal + (base * multiplierProduct);
            } else {
                catTotal = cat.items.reduce((sum, item) => {
                    if (item.on === false) return sum;
                    return sum + item.val;
                }, 0);
            }

            if (catTotal <= 0) catTotal = 0;
            
            document.getElementById(`total-${idx}`).innerText = catTotal.toFixed(2) + '%';
            
            if (catTotal === 0) {
                globalMultiplier = 0;
            } else {
                globalMultiplier *= (catTotal / 100);
            }

            const eff = catTotal > 0 ? (1 / catTotal) * 100 : 0;
            efficiencies.push({ index: idx, val: eff, total: catTotal });
            document.getElementById(`eff-${idx}`).innerText = '+' + eff.toFixed(3) + '%';
        });

        const maxEff = Math.max(...efficiencies.map(e => e.val));
        const sorted = [...efficiencies].sort((a, b) => b.val - a.val);

        efficiencies.forEach(item => {
            const rank = sorted.findIndex(e => e.index === item.index) + 1;
            const card = document.getElementById(`card-${item.index}`);
            const bar = document.getElementById(`bar-${item.index}`);
            
            card.setAttribute('data-rank', rank);
            bar.style.backgroundColor = '';
            card.style.borderLeftColor = '';
            
            const width = (maxEff > 0) ? (item.val / maxEff) * 100 : 0;
            bar.style.width = `${width}%`;

            if (item.total > 280) {
                card.setAttribute('data-over', 'true');
                bar.style.backgroundColor = 'var(--alert-red)';
                bar.style.opacity = 0.2;
                card.style.borderLeftColor = 'var(--alert-red)';
            } else {
                card.setAttribute('data-over', 'false');
                if (rank > 1) {
                    const opacity = (maxEff > 0) ? Math.max(0.1, (item.val / maxEff) * 0.2) : 0; 
                    bar.style.opacity = opacity;
                    card.style.borderLeftColor = `rgba(0, 229, 255, ${Math.max(0.3, item.val / maxEff)})`;
                } else {
                    bar.style.opacity = 0.15;
                }
            }
        });

        totalDisplay.innerText = globalMultiplier.toLocaleString(undefined, { maximumFractionDigits: 2, minimumFractionDigits: 2 });
    }

    init();

</script>

</body>
</html>